<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Crypto Primitives - docs</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Gadgets</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="gadgets/gadgets.html"><strong aria-hidden="true">2.1.</strong> Primitive Types</a></li><li class="chapter-item expanded "><a href="gadgets/complex_gadgets.html"><strong aria-hidden="true">2.2.</strong> Complex Gadgets/Merkle Tree</a></li></ol></li><li class="chapter-item expanded "><a href="crypto_primitives.html" class="active"><strong aria-hidden="true">3.</strong> Crypto Primitives</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">docs</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="crypto-primitives"><a class="header" href="#crypto-primitives">Crypto Primitives</a></h1>
<h2 id="pedersen-hash-functioncommitment"><a class="header" href="#pedersen-hash-functioncommitment">Pedersen Hash Function/Commitment</a></h2>
<p>The Pedersen hash functions are nothing more than fixing an elliptic curve point <code>G</code>, and then
doing </p>
<pre><code>hash(x) = xG
</code></pre>
<p>for a given <code>x</code>, which is an element of a finite field. The Pedersen <code>parameters</code> are just the sampling of the <code>G</code>. Different values of <code>G</code> give rise to a different Pedersen Hash.</p>
<p>Note that there's a very important difference between popular hash functions like <code>Keccak</code>/<code>SHA3</code> and <code>Pedersen</code>: the input of <code>SHA3</code> is just an array of bytes of arbitrary length, and its output a fixed byte array. On the other hand, <code>Pedersen</code>'s input has to be a finite field element (and therefore cannot be of arbitrary length) and its output is an elliptic curve element. Indeed, this is the entire point of it; it's meant to be used in the context of ZK-SNARKS/circuits, where computation is done on elliptic curves over finite fields.</p>
<p>The above poses a problem for <code>Pedersen</code> however. When using it as the underlying hash function for a Merkle Tree, one needs to take a pair of leaves or nodes and hash both to produce the next node in the tree. When using something like <code>SHA3</code>, what we do is hash the concatenation of the leaves/nodes, so we can use the same hash function we use to hash leaves to hash pairs of inner nodes. In the <code>Pedersen</code> case we can't do this, because the length of its inputs is fixed; concatenating inputs will not work.</p>
<p>Because of this, <code>Pedersen</code> is usually divided into categories called <code>OneToOne</code>, <code>TwoToOne</code>, <code>FourToOne</code>, etc. <code>OneToOne</code> takes one input and produces one output, so it's used for hashing leaves; <code>TwoToOne</code> takes two inputs into one output and it's used for hashing pairs of leaves/nodes, and so on.</p>
<p>With this in mind, let's take a look at the <code>MerkleTree</code> struct defined in <code>Arkworks</code>:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct MerkleTree&lt;P: Config&gt; {
    /// stores the non-leaf nodes in level order. The first element is the root node.
    /// The ith nodes (starting at 1st) children are at indices `2*i`, `2*i+1`
    non_leaf_nodes: Vec&lt;TwoToOneDigest&lt;P&gt;&gt;,
    /// store the hash of leaf nodes from left to right
    leaf_nodes: Vec&lt;LeafDigest&lt;P&gt;&gt;,
    /// Store the two-to-one hash parameters
    two_to_one_hash_param: TwoToOneParam&lt;P&gt;,
    /// Store the leaf hash parameters
    leaf_hash_param: LeafParam&lt;P&gt;,
    /// Stores the height of the MerkleTree
    height: usize,
}
<span class="boring">}
</span></code></pre></pre>
<p>Here, the <code>leaf_nodes</code> are of type <code>LeafDigest</code>, which are different from the <code>non_leaf_nodes</code>, which are <code>TwoToOneDigest</code>. These are generic types that represent the output of a <code>OneToOne</code> and <code>TwoToOne</code> ZK-Friendly hash function (like <code>Pedersen</code>, but it could be another one), respectively.</p>
<p>Additionally, there are <code>leaf_hash_param</code> and <code>two_to_one_hash_param</code> fields, containing the parameters mentioned above for the <code>OneToOne</code> and <code>TwoToOne</code> hash functions, respectively.</p>
<p>If you're wondering, the generic type <code>Config</code> just contains the types of the two hash functions used:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait Config {
    type LeafHash: CRH;
    type TwoToOneHash: TwoToOneCRH;
}
<span class="boring">}
</span></code></pre></pre>
<p><code>CRH</code> stands for <code>Collision Resistant Hash</code>.</p>
<h3 id="pedersen-commitment"><a class="header" href="#pedersen-commitment">Pedersen Commitment</a></h3>
<p>So far we have only talked about the <code>Pedersen</code> hash function, not the commitment. Even though one usually thinks of all hash functions as commitments themselves, cryptographers do not consider the above <code>Pedersen</code> hash function as one. The reason is that a commitment must satisfy two properties:</p>
<ul>
<li>
<p>It must be <code>binding</code>. The commiter must not be able to open the commitment at a different value than they originally commited to. Let's go through a concrete example with hash functions to explain what this means. Let's say Alice and Bob go through a guessing game, where Alice chooses a number between 1 and 10 and Bob has to guess it.</p>
<p>To make sure Alice isn't cheating, she first hashes the number and gives the hash to Bob. Thanks to this, when the game ends and Alice reveals the number <code>x</code> she chose, Bob can check whether Alice is lying or not by hashing it. This relies on one assumption, namely, that the hash function will not give the same result for two different values of <code>x</code> (this is known  as <code>collision resistance</code>).</p>
</li>
<li>
<p>It must be <code>hiding</code>. A commitment to some data should not reveal anything about it.</p>
</li>
</ul>
<p>The <code>Pedersen</code> hash above is <code>binding</code>, as it's collision resistant, but it is not <code>hiding</code>. This is because the hash of the data reveals something about it, the hash itself. This might seem like a minor thing but it's actually a big deal.</p>
<p>Let's say we're working with a private blockchain, where a user's balance has to live on the blockchain for auditability, but needs to be private. One way to do it would be to store <em>hashes</em> of user balances. This way, users <em>commit</em> to their balance on-chain without revealing it. If we used the <code>Pedersen</code> hash to do this, however, we would run into a problem. People could precompute the hashes of common values and then check for them on-chain.</p>
<p>For instance, we could compute the hash of <code>0</code>, obtaining <code>hash(0)</code>. Then we would immediately know which users have zero balance, by just scanning for balances with the <code>hash(0)</code> value.</p>
<p>To fix this, the <code>Pedersen</code> commitment is introduced. It works in the same way as the hash, but in addition to doing <code>xG</code>, we sample another public random curve point <code>H</code> and then, to compute the commitment of <code>x</code>, we sample a <em>private</em> random number <code>r</code>. Then, the pedersen commitment is</p>
<pre><code>commit(x) = xG + rH
</code></pre>
<p>This is now hiding, as the random value <code>r</code> is private. In the blockchain example above, the <code>0</code> balance does not always give the same pedersen commitment, as different people will sample a different value for <code>r</code>. People can no longer precompute the commitment of <code>0</code>, because there's no such thing as the one commitment of <code>0</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="gadgets/complex_gadgets.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="gadgets/complex_gadgets.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
